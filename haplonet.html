<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Haplonet-Inator‚Ñ¢Ô∏è - Nexusficadorinator-inator‚Ñ¢Ô∏è</title>
    <link rel="stylesheet" href="haplonet.css" />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü§ñ</text></svg>"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <!-- Pickr Color Picker -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/monolith.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>
    <script
      type="module"
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"
    ></script>
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>
          <a
            href="haplonet.html"
            style="
              color: inherit;
              text-decoration: none;
              display: inline-flex;
              align-items: center;
              gap: 0.5rem;
            "
            aria-label="Haplonet-Inator"
          >
            <i
              class="fa-solid fa-robot"
              style="font-size: 2.5rem; vertical-align: middle"
            ></i>
            Haplonet-Inator<sup>‚Ñ¢</sup>
          </a>
        </h1>
        <p class="subtitle">
          Visualize e analise redes de hapl√≥tipos com algoritmo Median-Joining
        </p>
        <a href="index.html" class="back-link">
          <ion-icon name="arrow-back"></ion-icon>
          Voltar ao Conversor
        </a>
      </header>

      <main class="main-content">
        <!-- Upload Section -->
        <section id="uploadSection" class="section">
          <div class="upload-card">
            <h2>Carregar Dados FASTA</h2>
            <p class="subtitle">
              Envie seu arquivo FASTA alinhado para gerar a rede de hapl√≥tipos
            </p>

            <div class="drop-zone" id="dropZone">
              <ion-icon name="cloud-upload" class="drop-icon"></ion-icon>
              <p>Arraste seu arquivo FASTA aqui</p>
              <span class="drop-text">ou</span>
              <button class="btn-primary" id="selectFileBtn">
                <ion-icon name="folder-open"></ion-icon>
                Selecionar arquivo
              </button>
              <input
                type="file"
                id="fastaInput"
                accept=".fas,.fasta,.fa,.txt"
                hidden
              />
            </div>

            <div class="file-card" id="fileCard" style="display: none">
              <div class="file-info">
                <ion-icon name="document-text"></ion-icon>
                <div>
                  <div class="file-name" id="fileName"></div>
                  <div class="file-size" id="fileSize"></div>
                </div>
              </div>
              <button
                class="btn-icon"
                id="removeFileBtn"
                title="Remover arquivo"
              >
                <ion-icon name="close-circle"></ion-icon>
              </button>
            </div>

            <div class="file-stats" id="fileStats" style="display: none">
              <div class="stat">
                <span class="stat-label">Sequ√™ncias:</span>
                <span class="stat-value" id="seqCount">0</span>
              </div>
              <div class="stat">
                <span class="stat-label">Comprimento:</span>
                <span class="stat-value" id="seqLength">0</span>
              </div>
              <div class="stat">
                <span class="stat-label">Hapl√≥tipos:</span>
                <span class="stat-value" id="hapCount">0</span>
              </div>
            </div>
          </div>
        </section>

        <!-- Network Options -->
        <section id="optionsSection" class="section" style="display: none">
          <div class="options-card">
            <h2>Localidades detectadas:</h2>

            <!-- Location Selection -->
            <div
              class="location-config"
              id="locationConfig"
              style="display: none"
            >
              <div id="locationSelection"></div>
            </div>

            <button class="btn-primary btn-large" id="generateNetworkBtn">
              <ion-icon name="git-network"></ion-icon>
              Gerar Rede de Hapl√≥tipos
            </button>
          </div>
        </section>

        <!-- Network Visualization -->
        <section id="networkSection" class="section" style="display: none">
          <div class="network-card">
            <div class="network-header">
              <div class="network-title-row">
                <h2>üï∏Ô∏è Rede de Hapl√≥tipos</h2>
                <div class="network-actions">
                  <button class="btn-secondary" id="exportPNGBtn">
                    <ion-icon name="download"></ion-icon>
                    Exportar PNG
                  </button>
                  <button class="btn-secondary" id="resetLayoutBtn">
                    <ion-icon name="refresh"></ion-icon>
                    Resetar Layout
                  </button>
                </div>
              </div>
            </div>

            <div class="canvas-container">
              <canvas id="networkCanvas"></canvas>

              <!-- Canvas Legend Panel -->
              <div
                id="canvasLegendPanel"
                class="canvas-legend-panel"
                style="display: none"
              >
                <div class="canvas-legend-header">Legenda</div>
                <div
                  class="canvas-legend-proportion"
                  id="canvasLegendProportion"
                ></div>
                <div
                  class="canvas-legend-locations"
                  id="canvasLegendLocations"
                ></div>
              </div>

              <div class="node-size-control">
                <label for="nodeSizeSlider">Tamanho dos n√≥s</label>
                <input
                  type="range"
                  id="nodeSizeSlider"
                  min="0.5"
                  max="2.5"
                  step="0.1"
                  value="1.0"
                />
              </div>
              <div id="tipContainer" class="tip-container">
                <button id="tipIcon" class="tip-icon" title="Mostrar dica">
                  <i class="fa-solid fa-circle-info"></i>
                </button>
                <div id="tipContent" class="tip-content" style="display: none">
                  <strong>üí° Instru√ß√µes de uso:</strong>
                  <ul
                    style="
                      margin: 0 0 0.5em 1.2em;
                      padding: 0;
                      font-size: 0.97em;
                    "
                  >
                    <li><b>Arraste os n√≥s</b> para reposicionar livremente.</li>
                    <li>
                      <b>Arraste o texto de um n√≥</b> para mudar a posi√ß√£o
                      apenas DAQUELE texto (zonas azuis).
                    </li>
                    <li>
                      <b>Shift + arraste o texto</b> para mudar a posi√ß√£o de
                      TODOS os textos (zonas amarelas).
                    </li>
                    <li><b>Scroll do mouse</b> para dar zoom.</li>
                    <li>
                      <b>Segure Espa√ßo + arraste</b> para mover toda a rede
                      (panning).
                    </li>
                    <li>
                      <b>Clique e arraste no fundo</b> para selecionar m√∫ltiplos
                      n√≥s.
                    </li>
                    <li>
                      <b>Shift + clique</b> em n√≥s para adicionar/remover da
                      sele√ß√£o.
                    </li>
                    <li><b>ESC</b> para limpar sele√ß√£o.</li>
                  </ul>
                  <b>Painel de legendas:</b>
                  <ul
                    style="
                      margin: 0 0 0.5em 1.2em;
                      padding: 0;
                      font-size: 0.97em;
                    "
                  >
                    <li>
                      Clique nos <b>bot√µes de cores</b> para escolher nova cor.
                    </li>
                    <li>
                      Os bot√µes de cores do canto superior direito do painel de
                      legendas controlam respectivamente:
                      <ul
                        style="
                          margin: 0.2em 0 0.5em 1.2em;
                          padding: 0;
                          font-size: 0.97em;
                        "
                      >
                        <li><b>Background</b></li>
                        <li><b>Linhas, texto e bordas</b></li>
                        <li><b>Muta√ß√µes</b></li>
                        <li><b>Medianos</b></li>
                      </ul>
                    </li>
                  </ul>
                  <b>Muta√ß√µes:</b>
                  <ul
                    style="
                      margin: 0 0 0.5em 1.2em;
                      padding: 0;
                      font-size: 0.97em;
                    "
                  >
                    <li>
                      <b>Alternar muta√ß√µes</b> (<span style="font-weight: 600"
                        >123/|||</span
                      >): muda entre n√∫mero e tra√ßo nas arestas.
                    </li>
                    <li>
                      <b>Toggle "Muta√ß√µes"</b>: mostra ou esconde as muta√ß√µes na
                      rede.
                    </li>
                  </ul>
                  <b>Exporta√ß√£o:</b>
                  <ul
                    style="
                      margin: 0 0 0.5em 1.2em;
                      padding: 0;
                      font-size: 0.97em;
                    "
                  >
                    <li>
                      <b>Exportar PNG/SVG</b>: baixe a visualiza√ß√£o da rede como
                      imagem.
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="network-header">
              <div class="network-title-row">
                <div class="network-stats">
                  <span class="stat-inline"
                    ><strong>N√≥s:</strong> <span id="nodeCount">0</span></span
                  >
                  <span class="stat-inline"
                    ><strong>Conex√µes:</strong>
                    <span id="edgeCount">0</span></span
                  >
                  <span class="stat-inline"
                    ><strong>Componentes:</strong>
                    <span id="componentCount">0</span></span
                  >
                </div>
                <div class="legend-global-colors">
                  <div class="pickr-wrapper" title="Cor de fundo">
                    <div id="backgroundColor" class="color-picker"></div>
                  </div>
                  <div class="pickr-wrapper" title="Cor das conex√µes">
                    <div id="edgeColor" class="color-picker"></div>
                  </div>
                  <div class="pickr-wrapper" title="Cor das muta√ß√µes">
                    <div id="mutationColor" class="color-picker"></div>
                  </div>
                  <div class="pickr-wrapper" title="Cor dos medianos">
                    <div id="medianColor" class="color-picker"></div>
                  </div>
                </div>
                <div class="network-toggles">
                  <button
                    class="mutation-toggle"
                    id="mutationToggle"
                    title="Alternar entre n√∫meros e tra√ßos"
                  >
                    <span class="toggle-track">
                      <span class="toggle-thumb"></span>
                      <span class="toggle-label left">123</span>
                      <span class="toggle-label right">|||</span>
                    </span>
                  </button>
                  <label class="checkbox-toggle">
                    <input type="checkbox" id="showMutations" checked />
                    <span class="toggle-slider"></span>
                    <span class="toggle-text">Muta√ß√µes</span>
                  </label>
                  <label class="checkbox-toggle">
                    <input type="checkbox" id="includeLegendOnExport" checked />
                    <span class="toggle-slider"></span>
                    <span class="toggle-text">Incluir Legenda</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
          <p>
            <ion-icon name="information-circle-outline"></ion-icon>
            Sistema desenvolvido para an√°lises filogen√©ticas e filogeogr√°ficas
          </p>
          <div
            style="
              display: flex;
              gap: 1rem;
              align-items: center;
              flex-wrap: wrap;
              justify-content: center;
            "
          >
            <a href="./README.md" target="_blank" class="footer-link">
              <ion-icon name="help-circle-outline"></ion-icon>
              Ver documenta√ß√£o
            </a>
            <a href="./index.html" class="footer-link">
              <ion-icon name="swap-horizontal-outline"></ion-icon>
              Nexusficador-inator‚Ñ¢
            </a>
          </div>
          <p>
            <a
              href="https://bontempoweb.com"
              rel="nofollow"
              target="_blank"
              class="hover:text-white transition"
            >
              Feito por BontempoWeb
            </a>
          </p>
        </footer>
      </main>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="spinner-overlay" style="display: none">
      <div class="spinner"></div>
      <p>Processando...</p>
    </div>

    <!-- Error Display -->
    <div id="errorDisplay" class="error-banner" style="display: none">
      <ion-icon name="alert-circle"></ion-icon>
      <span id="errorMessage"></span>
      <button
        class="error-close"
        onclick="document.getElementById('errorDisplay').style.display='none'"
      >
        <ion-icon name="close"></ion-icon>
      </button>
    </div>

    <!-- Toast -->
    <div id="successToast" class="toast" style="display: none">
      <ion-icon name="checkmark-circle"></ion-icon>
      <span id="toastMessage"></span>
    </div>

    <!-- Tooltip -->
    <div id="tooltip" class="tooltip" style="display: none"></div>

    <script src="haplonet.js"></script>
  </body>
</html>
